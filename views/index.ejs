<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" href="img/clash.png">
  <title>Gameplae</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.3.11/css/skins/skin-black.css">
  <script src = "https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.3.11/js/app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.3.11/css/AdminLTE.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.3.11/css/skins/skin-blue.css">

  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/glide.core.css">
  <link rel="stylesheet" href="/css/glide.theme.min.css">
  <link rel="stylesheet" href="/css/styleindex.css">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body class="hold-transition sidebar-collapse sidebar-mini">
  <!-- Site wrapper -->
  <div class="wrapper">
    <%- include("./partials/header.ejs") %>
      <aside class="main-sidebar">
          <!-- sidebar: style can be found in sidebar.less -->
          <section class="sidebar">
              <form action="#" method="get" class="sidebar-form" target="_blank">
                  <div class="input-group m-2 mt-4">
                      <input type="text" name="id" id = "search" class="form-control bg-dark" placeholder="How may I help?" style = "border: 0;">
                      <span class="input-group-btn bg-dark mr-2">
                          <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                          </button>
                      </span>
                  </div>
              </form>
              <!-- sidebar menu: : style can be found in sidebar.less -->
              <ul class="sidebar-menu">
                  <li class="header text-center" style = "color: #808080">Tournaments</li>
                  <% _.forEach(games, (game) => { %>
                    <li id = "Gname"><a href="/tournaments/<%= game.name %>"><i class="fas fa-gamepad" style = "background: -webkit-linear-gradient(#02e097, #06619B);font-weight: bold;background-clip: text;-webkit-background-clip: text;-webkit-text-fill-color: transparent;"></i> <span style = "color: #D3D3D3;font-weight: bolder;"><%= game.name %></span><span class = "badge badge-primary badge-pill pull-right"><%= game.tournaments.length %></span></a></li>
                  <% }) %>
              </ul>
          </section>
          <!-- /.sidebar -->
      </aside>
      <!-- =============================================== -->
      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper" style = "background: #0E0E10">
          <div class = "loader"></div>
          <section class="content">
                  <div>
                    <%- include("./partials/messages.ejs") %>
                    <div class="gliderr">
                      <div class="glide__track" data-glide-el="track">
                        <ul class="glide__slides">
                          <li class="glide__slide"><img src = "/img/adv2.jpg" style = "width: 100%;height: auto;"></li>
                          <li class="glide__slide"><img src = "/img/adv1.jpg" style = "width: 100%;height: auto;"></li>
                          <li class="glide__slide"><img src = "/img/pubgadv.jpg" style = "width: 100%;height: auto;"></li>
                          <li class="glide__slide"><img src = "/img/pubgadv2.jpg" style = "width: 100%;height: auto;"></li>
                        </ul>
                      </div>
                    </div>

                    <ul id="tabsJustified" class="nav nav-tabs nav-fill mt-3 mb-0">
                        <li class="nav-item" style = "background: #0E0E10"><a href="" data-target="#upcoming" data-toggle="tab" class="nav-link small text-uppercase active btn btn-dark">Upcoming</a></li>
                        <li class="nav-item" style = "background: #0E0E10"><a href="" data-target="#messages1" data-toggle="tab" class="nav-link small text-uppercase btn btn-dark">Joined</a></li>
                    </ul>
                    <br>
                    <div id="tabsJustifiedContent" class="tab-content" style = "margin-top: -30px">
                        <div id="upcoming" class="tab-pane fade active show">
                            <div class = "jumbotron mt-0 pt-0">
                                <% _.forEach(games, (game) => { %>
                                  <div class = "py-3 my-3" >
                                    <h3 class = "h3" id = "gameHead"><%= game.name %></h3>
                                    <div class = "row">
                                      <div class="glide">
                                          <div class="glide__track" data-glide-el="track">
                                            <ul class="glide__slides">
                                              <% _.forEach(game.tournaments, (tournament) => { %>
                                                <% if(tournament.starts >= new Date()){ %>
                                                  <% if(user){ %>
                                                    <a href = "/tournament/<%= tournament._id %>" style = "text-decoration: none;">
                                                      <li class="glide__slide">
                                                          <div class="card" style="max-width: 540px;background:#252525"> 
                                                              <div class="row no-gutters">
                                                                <div class="col-md-4">
                                                                  <img src="/img/<%= game.face %>" class="card-img" id = "face" style = "width:100%;height:auto;">
                                                                </div>
                                                                <div class="col-md-8">
                                                                  <div class="card-body" style = "margin-top: -10px;">
                                                                    <h5 class="card-title my-2" id = "tourHeading"><%= tournament.name %></h5>
                                                                    <div class="row">
                                                                      <div class="col"><p class="card-text mb-2" id = "con"><i class="fa fa-calendar my-3" id = "coni"></i> &nbsp; <%= moment(tournament.starts).format('l'); %></p></div>
                                                                      <div class="col"><p class="card-text" id = "con"><i class="fa fa-trophy my-3" id = "coni"></i> &nbsp;  ₹‎1000 </p></div>
                                                                      <div class="w-100"></div>
                                                                      <div class="col"><p class="card-text" id = "con"><i class="	fa fa-money" id = "coni"></i> &nbsp;  ₹‎<%= tournament.price %>/kill</p></div>
                                                                      <div class="col"><p class="card-text" id = "con"><i class="	fa fa-users" id = "coni"></i> &nbsp;  <%= tournament.players.length %>/<%= tournament.participants %></p></div>
                                                                    </div>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                            </div>
                                                        </li>
                                                      </a> 
                                                  <% }else{ %>
                                                    <a style = "text-decoration: none;" data-toggle="modal" data-target="#myModal">
                                                      <li class="glide__slide">
                                                          <div class="card" style="max-width: 540px;background:#252525">
                                                              <div class="row no-gutters">
                                                                <div class="col-md-4">
                                                                  <img src="/img/<%= game.face %>" class="card-img" id = "face" style = "width:100%;height:auto;">
                                                                </div>
                                                                <div class="col-md-8">
                                                                  <div class="card-body" style = "margin-top: -10px;">
                                                                    <h5 class="card-title" style = "color:#d3d3d3"><%= tournament.name %></h5>
                                                                    <div class="row">
                                                                      <div class="col"><p class="card-text mb-2" id = "con"><i class="fa fa-calendar" style = "color:gold;font-size:12px;margin-bottom: 10px;"></i> &nbsp; <%= moment(tournament.starts).format('l'); %></p></div>
                                                                      <div class="col"><p class="card-text" id = "con"><i class="fa fa-trophy" style = "color:gold;font-size:15px;"></i> &nbsp;  ₹‎1000 </p></div>
                                                                      <div class="w-100"></div>
                                                                      <div class="col"><p class="card-text" id = "con"><i class="	fa fa-money" style = "color:gold;font-size:15px;"></i> &nbsp;  ₹‎<%= tournament.price %>/kill</p></div>
                                                                      <div class="col"><p class="card-text" id = "con"><i class="	fa fa-users" style = "color:gold;font-size:15px;"></i> &nbsp;  <%= tournament.players.length %>/<%= tournament.participants %></p></div>
                                                                    </div>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                            </div>
                                                        </li>
                                                      </a> 
                                                  <% } %>
                                                <% } %>
                                              <% }) %>
                                            </ul>
                                          </div>
                                        </div>
                                    </div>
                                  </div>
                                <% }) %>
                            </div>
                        </div>
                        <div id="messages1" class="tab-pane fade active">
                              <% if(user){ %>
                                <div class = "jumbotron">
                                  <h3 class = "h3 mt-3 text-center" style = "opacity: 0.8;font-family:arial;color: #252525">Your joined Tournaments will be shown here</h3>
                                </div>
                              <% }else{ %>
                                <div class = "jumbotron">
                                  <h3 class = "h3 mt-3 text-center" style = "opacity: 0.8;font-family:arial;color: #252525">Login to join Tournaments</h3>
                                </div>
                              <% } %>
                        </div>
                    </div>
                </div>    
              </section>
              <%- include("./partials/modals.ejs") %>                
            </div>

  <script src="https://cdn.jsdelivr.net/npm/@glidejs/glide"></script>
  <script>
  var sliders = document.querySelectorAll('.glide');
  var config = {
    type: 'carousel',
    perView: 2,
    peek: {
          before: 0,
          after: 350
    },
    touchRatio: 0.5,
    breakpoints: {
      1200: {
        perView: 2,
        peek: {
          before: 0,
          after: 135
        },
      },
      1000: {
        perView: 2,
        peek: {
          before: 0,
          after: 120
        },
      },
      900: {
        perView: 2,
        peek: {
          before: 0,
          after: 50
        },
      },
      770: {
        perView: 2,
        peek: {
          before: 0,
          after: 90
        },
      },
      639: {
        perView: 1,
        peek: {
          before: 0,
          after: 120
        },
        gap: 10
      },
      400: {
        perView: 1,
        peek: {
          before: 0,
          after: 80
        },
        gap: 10
      },
      360: {
        perView: 1,
        peek: {
          before: 0,
          after: 30
        },
      }
    }
  }
  for (var i = 0; i < sliders.length; i++) {
    var glide = new Glide(sliders[i],config);
    glide.mount();
  }
  </script>
  <script>
    var newConfig = {
      autoplay: 5000,
      type: 'carousel',
      autoheight: true,
      perView: 1,
      gap: 15,
      focusAt: 'center',
      peek: 290,
      breakpoints: {
        1400: {
          peek: 320
        },
        1200: {
          peek: 300
        },
        1000: {
          peek: 200,
          // gap: 7
        },
        800: {
          peek: 100
        },
        600: {
          peek: 70,
          gap: 5
        },
        350: {
          peek: 50,
          gap: 5
        }
      }
    }
    var glide = new Glide(".gliderr", newConfig).mount();
  </script>
  <% if(upi.rnum && upi.holder){ %>
    <script>
      $('#newUpi').hide();  
    </script>
  <% } %>
  <% if(successMsg){ %>
    <script>
    $(document).ready(function(){
        $("#successModal").modal('show');
    });
    </script>
  <% } %>
  <script>
    document.onreadystatechange = function() { 
    if (document.readyState !== "complete") { 
        document.querySelector(".loader").style.visibility = "visible"; 
        document.querySelector("body").style.visibility = "hidden"; 
    } else { 
        document.querySelector(".loader").style.display = "none";
        document.querySelector("body").style.visibility = "visible"; 
    } 
  };
  </script>
  <% if(pay){ %>
    <script>
      $(document).ready(function(){
      function validateUpi(pVal, hVal, aVal){
          if(pVal && hVal && aVal){
                $('#upiSubmit').removeAttr("disabled");
                $('#upiSubmit').html("Submit Request")
                $('#upiSubmit').removeClass('btn-danger');
                $('#upiSubmit').addClass('btn-primary');
            }else{
              $('#upiSubmit').attr("disabled", "true");
              $('#upiSubmit').html("Fix All the errors");
              $('#upiSubmit').removeClass('btn-primary');
                $('#upiSubmit').addClass('btn-danger');
            }
      }
        
      var $regexname=/^([0-9]{10})$/;
      var pVal = false;
      var hVal = false;
      var aVal = false;
      $('.phVal').on('keypress keydown keyup',function(){
              if (!$(this).val().match($regexname)) {
                  $('.pVal').removeClass('hidden');
                  $('.pVal').show();
                  pVal = false;
                  validateUpi(pVal, hVal, aVal);
              }
            else{
                  $('.pVal').addClass('hidden');
                  pVal = true;
                  validateUpi(pVal, hVal, aVal);
                  }
                });

      $('.hoVal').on('keypress keydown keyup',function(){
          if (!$(this).val().match(/^([a-z A-Z]{2,100})$/)) {
              $('.hVal').removeClass('hidden');
              $('.hVal').show();
              hVal = false;
              validateUpi(pVal, hVal, aVal)
          }
        else{
              $('.hVal').addClass('hidden');
              hVal = true;
              validateUpi(pVal, hVal, aVal)
              }
            });
              
      $('.amVal').on('keypress keydown keyup',function(){
                if (parseInt("<%= user.wallet %>") < $('.amVal').val()) {

                    $('.aVal').removeClass('hidden');
                    $('.aVal').show();
                    aVal = false;
                    validateUpi(pVal, hVal, aVal)
                }
              else{
                  $('.aVal').addClass('hidden');
                  aVal = true;
                  validateUpi(pVal, hVal, aVal)

                }
            });
        });
    </script>  
  <% } %>
  <script src = "/js/wallet.js"></script>
</body>
</html>